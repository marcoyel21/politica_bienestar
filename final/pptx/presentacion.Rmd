---
title: "Evaluación de impacto de la Reforma en Telecomunicaciones del 2013 en logro educativo en México"
author: "Cynthia Valdivia, Samantha Cervantes, Marco Ramos"
date: "Mayo 2021"
output:
  xaringan::moon_reader:
    css: xaringan-themer.css  
    self_contained: true
    lib_dir: libs
    nature:
      highlightStyle: github
      countIncrementalSlides: false
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
options(scipen = 999)
```

```{r xaringan-themer, include=FALSE, warning=FALSE}
library(xaringanthemer)
style_mono_accent(
  base_color = "#1c5253",
  header_font_google = google_font("Josefin Sans"),
  text_font_google   = google_font("Montserrat", "500", "600i")
)
```


<div style="text-align: justify">
  
## Motivación



---
## Modelo: Regresión discontinua

 $$\delta NivelLogro_i =\beta_0 + \beta_1 T_i + \beta_2 G_i +\beta_3 X_i  + u_i$$

y

T_i =& 
  \begin{cases}
    1, & G_i \geq c \\
    0, & G_i < c
  \end{cases}

Donde $i$ indica localidades y

$T_i$ es la variable de tratamiento, la cual está determinada por un límite, o punto $c_i$ de la variable definitoria, que será de 15 pp

$G_i$, es la variable definitoria, que en este caso es la tasa de cambio en la adopción de Internet de las localidades 

---

Para estimar el efecto de tratamiento, o la $\beta_1$, se utilizarán observaciones con una $G_i$ cerca a $c_i$. Se asume que la discontinuidad, o el salto, es el efecto causal.

Se utilizara un diseno Sharp, ya que la asignación a tratamiento es determinística y discontinua en el punto de corte: todas las observaciones con un $G_i < c $ serán parte del control y todas las que tengan un valor de $G_i >= c $ del tratamiento. 

---
## Datos

Las unidades de analisis son localidades, obtenidas de las bases de *Principales resultados por Localidad (ITER)* de la INEGI de los anios 2010 y 2020, asi como de las bases de Enlace del 2010 y Planea del 2019.

La base original consiste en 13,XXX observaciones. Sin embargo, nuestra muestra se restringe a localidades rurales (con poblacion menor a 2,500 habitantes), lo cual reduce a la base a 11,597 observaciones. 

---

## Resúmenes estadísticos de variables


```{r}
#Creamos variable de tratamiento y recodificamos la de marginacion

data<-data[which(pobtot<2500),]
data$cp_15pp<-as.numeric(ifelse(data$cambio_internet<15,0,1))
data$marg<-recode(data$marg_10, 'BAJA O MUY BAJA'=3, 'MUY ALTA O ALTA'=2, 
                  'MEDIA'=1)

as.numeric(data$marg)

```

```{r}
library(stargazer)
f_data<-data %>% select (cambio_esp_top,cambio_mat_top,cp_15pp,promesc_20,marg,cel_20,pocup_20)
stargazer(f_data,header=FALSE)

```

FALTAN LAS DE MARCO

---
## Estadisticas descriptivas: RD

En el contexto de RD, hacer un scatterplot simple de los datos no es beneficioso, ya que no permite distinguir los saltos en los datos. Los datos deben agregarse, o suavizarse antes de graficarse. En las siguientes gráficas se muestra un ajuste polinomial global (línea) y las medias muestrales locales (puntos).

El ajuste polinomial es una aproximacion suavizada basada en regresiones polinomiales de cuarto o quinto orden de la variable dependiente, separada en control y tratamiento. 

Las medias muestrales locales se construyen a partir de intervalos o *bins* de $G_i$, calculando la media de la Y para las observaciones que caen dentro de cada intervalo. En este caso utilizaremos el método cuantil-espaciado, en el que cada bin tendrá el mismo número de observaciones usando regresiones polinomiales. Esto para ver más "fielmente" cómo se comporta $G_i$.

---

Sin considerar a los controles o el ancho del intervalo alrededor del punto de corte, los grupos se ven así: 

```{r}
out6<- rdplot(cambio_esp_top,cambio_internet,nbins=c(20,20),kernel="triangular",c=15, binselect = "qspr")
```

```{r}
out7<- rdplot(cambio_mat_top,cambio_internet,nbins=c(20,20),c=15,kernel="triangular", binselect = "qspr")
```
---

Ahora, verificaremos cual es el ancho de banda optima si queremos realizar una estimacion con regresion kernel de tipo triangular, un corte de 15, y orden del polinomio de 4:

```{r}
out = rdbwselect(cambio_esp_top, cambio_internet,c=15, kernel = "triangular", p = 4, bwselect = "mserd")
summary(out)
```

Observamos que el ancho de banda optimo (que implica esto?) es de 14.

En el caso de matematicas:

```{r}
out = rdbwselect(cambio_mat_top, cambio_internet,c=15, kernel = "triangular", p = 4, bwselect = "mserd")
summary(out)
```

Observamos que es de 12. 

---
---
## Covariables

Para incluir a las covariables en nuestra estimacion, debemos verificar que no sean distintas en el grupo de tratamiento y de control en el punto de corte (+/- el ancho de banda). En caso de que fueran distintas, no se cumpliria el supuesto de continuidad, por lo que se tendrian que imponer restricciones adicionales. 

Entonces, definimos a las covariables: 

Z_i =& 
  \begin{cases}
    1, & G_i \geq c \\
    0, & G_i < c
  \end{cases}

Donde Zi(1) y Zi(0) denotan dos vectores de covariables de potenciales- Zi(1) representa el valor que toman las covariables arriba del punto de corte (tratamiento) y Zi(0) los respectivos del control. Se asume que el valor de las covariables fue determinado antes del tratamiento, por lo que su efecto de tratamiento es cero. 

---
OJO. deberiamos de meter una de regiones

```{r}
# Ahora vamos a ver si covariates son iguales en el punto de corte

data$marg<-recode(data$marg_10, 'BAJA O MUY BAJA'=3, 'MUY ALTA O ALTA'=2, 
                  'MEDIA'=1)

as.numeric(data$marg)

```

```{r}
#este es con un ancho de banda de 12

marg_C<-(data$marg[cambio_internet>=2 & cambio_internet<=14])
marg_T<-(data$marg[cambio_internet>=15 & cambio_internet<=27])

promesc_C<-(data$promesc_20[cambio_internet>=2 & cambio_internet<=14])
promesc_T<-(data$promesc_20[cambio_internet>=15 & cambio_internet<=27])

pocup_C<-(data$pocup_20[cambio_internet>=2 & cambio_internet<=14])
pocup_T<-(data$pocup_20[cambio_internet>=15 & cambio_internet<=27])

```

```{r}
# con ancho de banda de 12

#prom esc es igual en tratamiento y control en el punto de corte (con un bandwidth de 5)

t.test(promesc_T,promesc_C,alternative="two.sided")

#Pob ocupada si es igual en el punto de corte (con un bandwidth de 5)

t.test(pocup_T,pocup_C,alternative="two.sided")


# marginacion. si son iguales

t.test(marg_T,marg_C,alternative="two.sided")


```

El balance entre el grupo de control y el grupo de tratamiento **en el punto de corte** es:

```{r}

# kable...


```

Dado que las covariables si estan balanceadas dentro del punto de corte y el ancho del intervalo [c-h,c+h], podemos incluirlas en la estimacion.

---

Ahora vemos como cambian nuestras dispersiones al incorporar estos resultados las covariables y el ancho de banda adecuado:

```{r}
Z = cbind(data$marg, data$promesc_20,data$pocup_20)
colnames(Z) = c("Marginacion", "Promedio escolaridad", "Pob. ocupada")
out<-rdplot(data$cambio_esp_top,data$cambio_internet,nbins=c(20,20),covs=Z, kernel = "triangular",c=15,h=14, binselect = "qspr")

```

```{r}
out6<- rdplot(cambio_mat_top,cambio_internet,nbins=c(20,20),c=15, covs=Z,kernel = "triangular",h=12,binselect = "qspr")
```



---

## Implementación

Ahora, realizaremos nuestra estimacion usando el ancho de banda adecuado segun nuestros datos (se indica en la funcion), una regresion kernel triangular, errores agrupados a nivel municipal, el punto de corte en 15, y los regresores por localidad: promedio de anios de escolaridad, poblacion ocupada, y nivel de marginacion:

```{r}
out = rdrobust(data$cambio_esp_top,data$cambio_internet, covs = Z, kernel = "triangular", c=15,p = 4, bwselect = "mserd",cluster=data$ClaveMun)

summary(out)
```

```{r}
out = rdrobust(data$cambio_mat_top,data$cambio_internet, covs = Z, kernel = "triangular", c=15,p = 4, bwselect = "mserd",cluster=data$ClaveMun)

summary(out)
```


Interpretacion con lo q tenemos ahorita: La interpretacion es que dentro del intervalo de 10 puntos porcentuales, el porcentaje de calificaciones de espanol que *cambia*  disminuye en 1.12  puntos porcentuales en espanol y 1.34 en matematicas debido al acceso a Internet: X% de las escuelas de las localidades rurales tuvieron un cambio en el acceso a internet de -10 pp, mientras que X% de las escuelas de localidades rurales tuvieron un cambio en el acceso a Internet de hasta 10 pp

Interpretacion ideal: El porcentaje de alumnos que cambian de posicion (top/bottom o vicerversa) aumentan/disminuyen en X pp debido al acceso a Internet. El % de localidades rurales que apenas tienen internet (+ 5 pp arriba del corte) es de X%, mientras que el % de localidades rurales que por poco tendrian internet (- 5 pp debajo del corte) es de %

```{r pressure, echo=FALSE}
print(out$beta_p_r)
```

```{r pressure, echo=FALSE}
print(out$beta_p_l)
```

We see that the RD eect of 3.020 percentage points in the female high school attainment
percentage is the dierence between a percentage of 15.6649438 percent in municipalities
where the Islamic party barely wins and a percentage of 12.6454218 percent in municipalities
where the Islamic party barely loses|that is, 15:6649438􀀀12:6454218  3:020. By accessing
the control mean at the cuto in this way, we learn that the RD eect represents an increase
of (3:020=12:6454218)  100 = 23:88 percent relative to the control mean.


---
## Resultados

<div style="text-align: justify">
  
  + Relación hallazgos con bibliográfía 
  + Aportación del trabajo

$$IPV_{ist} = \gamma+ \delta \space Reform_{st} + X_{ist}\beta +\alpha_{s} +\mu_{t} + \epsilon_{ist}$$

$\alpha_{s}$ es el vector de efectos fijos (EF) que controla por el estado de residencia de la mujer

$\mu_{t}$ es el vector de EF de tiempo de la encuesta

---
## Conclusiones

+ Se comprueba la hipótesis
+ Aportación
+ Trabajo fitirp 
+ Aplicación en PP o privada

---

## Anexos

+ Pruebas q hicimos sin copy paste (?)

---

## Bibliografía

+ 8-10 artículos publicados de journals















