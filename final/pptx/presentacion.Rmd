---
title: "Evaluación de impacto de la Reforma en Telecomunicaciones del 2013 en logro educativo en México"
author: "Cynthia Valdivia, Samantha Cervantes, Marco Ramos"
date: "Mayo 2021"
output:
  xaringan::moon_reader:
    css: xaringan-themer.css  
    self_contained: true
    lib_dir: libs
    nature:
      highlightStyle: github
      countIncrementalSlides: false
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
options(scipen = 999)
```

```{r xaringan-themer, include=FALSE, warning=FALSE}
library(xaringanthemer)
style_mono_accent(
  base_color = "#1c5253",
  header_font_google = google_font("Josefin Sans"),
  text_font_google   = google_font("Montserrat", "500", "600i")
)
```


```{r, include=FALSE}

library(stargazer)
library(readr)
library(rdrobust)
library(dplyr)
library(kableExtra)


# Leer datos
urlfile="https://raw.githubusercontent.com/marcoyel21/politica_bienestar/master/final/avance/data.csv"

data<-read_csv(url(urlfile))
attach(data)

```

<div style="text-align: justify">
  
## Objetivo e Hipotesis

Este trabajo tiene como objetivo determinar:

* El impacto de la Reforma en Telecomunicaciones del 2013 en Mexico en el desempeño escolar, mediante un aumento en el acceso a Internet de localidades rurales.

Las hipotesis son: 

* La Reforma en Telecomunicaciones de 2013 impacto positivamente al nivel de competitividad del sector, reflejado en una disminucion de los precios de telefonia, aumento de la cobertura, y mejora de calidad del servicio. Esto provocaria una mayor demanda por servicios de Internet en los hogares. 
  
* Una mayor conectividad en los hogares de los alumnos causa un aumento en su desempeno escolar, especificamente en nuestro contexto el nivel de logro de los estudiantes de tercero de secundaria en las pruebas de matemáticas y español.  
    
    
```{r echo=FALSE, out.width = "800px", out.height="100px",fig.align='center'}
knitr::include_graphics("objetivo2.png")
```
---

<div style="text-align: justify">

## Introducción. Antecedentes y contexto

El panorama existente antes de la Reforma de 2013 era: 

* La alta concentración del mercado en el sector de las telecomunicaciones era una limitante para el crecimiento de la demanda de este. 

* Los  niveles  de  penetración  de  los  servicios  de  telecomunicaciones  en  la población  se  encontraban  dentro de los más bajos entre los países de la  OCDE.


La Reforma en Telecomunicaciones promulgada en junio del 2013:

* El acceso a Internet se convirtió en un derecho constitucional. 

* Se enfoco en promover una efectiva competencia con la regulacion asimetrica impuesta al Agente Economico Preponderante, como base para lograr mejor calidad en los servicios, la mejora de precios, y aumentar la cobertura por un mayor numero de competidores, de demanda, y de competencia.

* Implementó el Programa “México Conectado”, con el fin de llevar Internet de manera gratuita a más de 100 mil espacios públicos de todo el país; lo anterior a través de los llamados “Puntos, México Conectado”.

---
<div style="text-align: justify">

## Motivación

### ¿Por qué es relevante este estudio? ¿Por qué se eligió este tema?

* No hay precedentes de un análisis en el que se refleje la contribución de la Reforma en Telecomunicaciones de 2013 en el acceso a internet y con ello en el desempeño educativo.

* Es de vital importancia hacer investigaciones que se centren en medir los impactos de las modificaciones en legislaciones clave para la generación de políticas públicas apropiadas; sobre todo, considerando que dichos impactos tienden a afectar más a la población vulnerable.

* Derivado de la pandemia, hoy más que nunca resulta importante efectuar la valuación de una política como la de la Reforma, a través del programa “México Conectado”, y la medición de su impacto en la educación, con el fin de identificar áreas de oportunidad y ventanas de mejora. 

---

## Modelo: Regresión discontinua

Nuestra especificacion consiste en:

 $$\delta NivelLogro_i =\beta_0 + \beta_1 T_i + \beta_2 G_i +\beta_3 X_i  + u_i$$

donde

\begin{align*}
T_i =& 
  \begin{cases}
    1, & G_i \geq c \\
    0, & G_i < c
  \end{cases}
\end{align*}

$i$ indica la localidad, y:

$T_i$ es la variable de tratamiento, la cual está determinada por un límite, o punto $c_i$ de la variable definitoria, que será de 15 pp

$G_i$, es la variable definitoria, que en este caso es la tasa de cambio en la adopción de Internet de las localidades 

---

## Modelo: Regresión discontinua


Para estimar el efecto de tratamiento, o la $\beta_1$, se utilizarán observaciones con una $G_i$ cerca a $c_i$. Se asume que la discontinuidad, o el salto, es el efecto causal.

Se utilizara un diseno Sharp, ya que la asignación a tratamiento es determinística y discontinua en el punto de corte: todas las observaciones con un $G_i < c$ serán parte del control y todas las que tengan un valor de $G_i >= c$ del tratamiento. 

---

## Datos

Las bases de datos que utilizamos son las de *Principales resultados por Localidad (ITER)* de la INEGI de los anios 2010 y 2020, asi como de las bases de Enlace del 2010 y Planea del 2019. Se empataran las bases de Enlace y la de Localidades en el 2010, la de Planea y localidades en el 2020, y finalmente estas dos se combinaran en una sola donde las unidades de analisis seran las localidades, con informacion de los dos puntos del tiempo.

La base original consiste en 13,789 observaciones. Al restringir a la muestra a localidades rurales (con poblacion menor a 2,500 habitantes) que hayan participado en ambas evaluaciones (Enlace en 2010 y Planea en 2019), el numero de observaciones se reduce a 11,597 observaciones. 

---

## Resúmenes estadísticos de variables

```{r,include=FALSE, results='asis',echo=FALSE,message=FALSE,warning=FALSE}
#Creamos variable de tratamiento y recodificamos la de marginacion
data<-data[which(pobtot<2500),]
data$cp_15pp<-as.numeric(ifelse(data$cambio_internet<15,0,1))
data$marg<-recode(data$marg_10, 'BAJA O MUY BAJA'=3, 'MUY ALTA O ALTA'=2, 
                  'MEDIA'=1)
as.numeric(data$marg)
data <- data[(data$promesc_20<20), ]

attach(data)
```

```{r, results='asis',echo=FALSE,message=FALSE,warning=FALSE,header=FALSE,results='hide'}
dat<-data.frame(data$cambio_esp_top,data$cambio_mat_top,data$cambio_internet,data$cp_15pp,data$promesc_20,data$marg,data$pocup_20)
stargazer(dat,digits=2,type='text',title="Tabla 1. Resumen estadisticas descriptivas",covariate.labels =c("Cambio Espanol","Cambio Mate","Cambio Internet", "Tratamiento","Prom. Escol.",
                                                       "Marginacion","Pob. Ocupada"))

```

```{r, results = "asis", echo = FALSE, message = FALSE}
library(knitr)
tex2markdown <- function(texstring) {
  writeLines(text = texstring,
             con = myfile <- tempfile(fileext = ".tex"))
  texfile <- pandoc(input = myfile, format = "html")
  cat(readLines(texfile), sep = "\n")
  unlink(c(myfile, texfile))
}

textable <- "\\begin{table}[!htbp] \\centering 
  \\caption{Tabla 1. Resumen estadisticas descriptivas} 
  \\label{} 
\\begin{tabular}{@{\\extracolsep{5pt}}lccccccc} 
\\\\[-1.8ex]\\hline 
\\hline \\\\[-1.8ex] 
Statistic & \\multicolumn{1}{c}{N} & \\multicolumn{1}{c}{Mean} & \\multicolumn{1}{c}{St. Dev.} & \\multicolumn{1}{c}{Min} & \\multicolumn{1}{c}{Pctl(25)} & \\multicolumn{1}{c}{Pctl(75)} & \\multicolumn{1}{c}{Max} \\\\
\\hline \\\\[-1.8ex] 
Cambio Espanol & 11,515 & 2.99 & 7.74 & $-$71 & 0 & 3.3 & 100 \\\\ 
Cambio Mate & 11,515 & 5.38 & 17.13 & $-$100.00 & 0.00 & 6.72 & 100.00 \\\\ 
Cambio Internet & 11,515 & 11.74 & 11.39 & -12.04 & 2.20 & 18.79 & 85.71 \\\\
Tratamiento & 11,515 & 0.28 & 0.45 & 0 & 0 & 1 & 1 \\\\ 
Prom. Escol. & 11,515 & 1.99 & 2.25 & 0.11 & 0.69 & 2.38 & 19.97 \\\\ 
Marginacion & 11,515 & 1.91 & 0.51 & 1 & 2 & 2 & 3 \\\\ 
Pob. Ocupada & 11,515 & 42.68 & 11.63 & 0.00 & 35.80 & 49.17 & 91.62 \\\\ 
\\hline \\\\[-1.8ex] 
\\end{tabular} 
\\end{table}  "
tex2markdown(textable)
                                                    
```


---
## Histogramas X
.pull-left[
```{r} 
hist(data$cambio_internet)
```
]

.pull-right[

```{r} 
hist(data$cambio_pc)
```  
]
---
## Histogramas Y- Español

.pull-left[
```{r} 
hist(data$cambio_esp_top)
```
]

.pull-right[

```{r} 
hist(data$cambio_esp_bottom)
```  
] 
---

## Histogramas Y- Matemáticas

.pull-left[
```{r} 
hist(data$cambio_mat_top)
```
]

.pull-right[

```{r} 
hist(data$cambio_mat_bottom)
```  
]
  
---
## Regresiones Ingenuas- Español

```{r, results = "asis", echo = FALSE, message = FALSE}
a<-lm(cambio_esp_top~cambio_internet,data)
b<-lm(cambio_esp_top~cambio_pc,data)
c<-lm(cambio_esp_bottom~cambio_internet,data)
d<-lm(cambio_esp_bottom~cambio_pc,data)

textable <- "\\begin{table}[!htbp] \\centering 
  \\caption{} 
  \\label{} 
\\begin{tabular}{@{\\extracolsep{5pt}}lcccc} 
\\\\[-1.8ex]\\hline 
\\hline \\\\[-1.8ex] 
 & \\multicolumn{4}{c}{\\textit{Dependent variable:}} \\\\ 
\\cline{2-5} 
\\\\[-1.8ex] & \\multicolumn{2}{c}{cambio\\_esp\\_top} & \\multicolumn{2}{c}{cambio\\_esp\\_bottom} \\\\ 
\\\\[-1.8ex] & (1) & (2) & (3) & (4)\\\\ 
\\hline \\\\[-1.8ex] 
 cambio\\_internet & 0.047$^{***}$ &  & $-$0.041 &  \\\\ 
  & (0.006) &  & (0.028) &  \\\\ 
  & & & & \\\\ 
 cambio\\_pc &  & 0.098$^{***}$ &  & $-$0.220$^{***}$ \\\\ 
  &  & (0.019) &  & (0.082) \\\\ 
  & & & & \\\\ 
 Constant & 2.494$^{***}$ & 2.695$^{***}$ & $-$2.451$^{***}$ & $-$2.219$^{***}$ \\\\ 
  & (0.100) & (0.092) & (0.435) & (0.402) \\\\ 
  & & & & \\\\ 
\\hline \\\\[-1.8ex] 
Observations & 11,515 & 11,515 & 11,515 & 11,515 \\\\ 
\\end{tabular} 
\\end{table}  "
tex2markdown(textable)
```


---

## Regresiones ingenuas- Matemáticas

```{r, results = "asis", echo = FALSE, message = FALSE}

e<-lm(cambio_mat_top~cambio_internet,data)
f<-lm(cambio_mat_top~cambio_pc,data)
g<-lm(cambio_mat_bottom~cambio_internet,data)
h<-lm(cambio_mat_bottom~cambio_pc,data)

textable <- "\\begin{table}[!htbp] \\centering 
  \\caption{} 
  \\label{} 
\\begin{tabular}{@{\\extracolsep{5pt}}lcccc} 
\\\\[-1.8ex]\\hline 
\\hline \\\\[-1.8ex] 
 & \\multicolumn{4}{c}{\\textit{Dependent variable:}} \\\\
\\cline{2-5} 
\\\\[-1.8ex] & \\multicolumn{2}{c}{cambio\\_mat\\_top} & \\multicolumn{2}{c}{cambio\\_mat\\_bottom} \\\\ 
\\\\[-1.8ex] & (1) & (2) & (3) & (4)\\\\ 
\\hline \\\\[-1.8ex] 
 cambio\\_internet & $-$0.006 &  & 0.038 &  \\\\ 
  & (0.014) &  & (0.031) &  \\\\ 
  & & & & \\\\ 
 cambio\\_pc &  & 0.075$^{*}$ &  & $-$0.082 \\\\ 
  &  & (0.042) &  & (0.091) \\\\ 
  & & & & \\\\ 
 Constant & 5.444$^{***}$ & 5.150$^{***}$ & 6.884$^{***}$ & 7.546$^{***}$ \\\\ 
  & (0.222) & (0.205) & (0.482) & (0.445) \\\\ 
  & & & & \\\\ 
\\hline \\\\[-1.8ex] 
Observations & 11,515 & 11,515 & 11,515 & 11,515 \\\\ 
\\hline 
\\hline \\\\[-1.8ex] 
\\end{tabular} 
\\end{table}  "
tex2markdown(textable)
```


---

## Estadisticas descriptivas: RD

En el contexto de RD, hacer un scatterplot simple de los datos no es beneficioso, ya que no permite distinguir los saltos en los datos. Los datos deben agregarse, o suavizarse antes de graficarse. En las siguientes gráficas se muestra un ajuste polinomial global (línea) y las medias muestrales locales (puntos).

El ajuste polinomial es una aproximacion suavizada basada en regresiones polinomiales de cuarto o quinto orden de la variable dependiente, separada en control y tratamiento. 

Las medias muestrales locales se construyen a partir de intervalos o *bins* de $G_i$, calculando la media de la Y para las observaciones que caen dentro de cada intervalo. En este caso utilizaremos el método cuantil-espaciado, en el que cada bin tendrá el mismo número de observaciones usando regresiones polinomiales. Esto para ver más "fielmente" cómo se comporta $G_i$.

---

A analizar los datos de esta forma obtenemos los siguientes graficos. Podemos notar que una aproximacion lineal llevaria a errores de especificacion. 

.pull-left[
```{r,echo=FALSE,message=FALSE,warning=FALSE,header=FALSE}
out6<- rdplot(cambio_esp_top,cambio_internet,nbins=c(20,20),x.lim=c(-25,50),x.label="Cambio Internet",y.label="Cambio Espanol",title="",kernel="triangular",c=15, binselect = "qspr")
```
]

.pull-right[
```{r, echo=FALSE,message=FALSE,warning=FALSE,header=FALSE}

out7<- rdplot(cambio_mat_top,cambio_internet,nbins=c(20,20),x.lim=c(-10,50),y.lim=c(0,20),x.label="Cambio Internet",y.label="Cambio Mate",title="",c=15,kernel="triangular", binselect = "qspr")
```
]

---

Posteriormente, verificamos cual es el ancho de banda ideal, *h*. Este controla el ancho de la vecindad alrededor del punto de corte, $c_i$. Su eleccion es fundamental ya que esta afecta a la forma funcional y a obtencion de los estimadores para calcular el ATE; os resultados suelen ser muy sensibles a este valor. Si las observaciones cerca del punto de corte se acercan a una forma lineal, podemos usar un orden menor a 4 o 5.

Verificaremos cual es el ancho de banda optima si queremos realizar una estimacion con regresion kernel de tipo triangular, un corte de 15, y orden del polinomio de 1:

```{r, echo=FALSE,message=FALSE,warning=FALSE,header=FALSE}
out = rdbwselect(cambio_esp_top, cambio_internet,c=15, kernel = "triangular", p = 1, bwselect = "mserd")
summary(out)
```

Elegimos la funcion de kernel triangular ya que esta es la recomendada para este tipo de analisis, ya que proporciona estimadores puntuales que minimizan al error cuadrado medio.

---

En el caso de matematicas:

```{r, echo=FALSE,message=FALSE,warning=FALSE,header=FALSE}
out = rdbwselect(cambio_mat_top, cambio_internet,c=15, kernel = "triangular", p = 1, bwselect = "mserd")
summary(out)
```

Observamos que en el caso de espa;ol *h* es de 5 y en matematicas de 6. 

---

Al incorporar los anchos de banda adecuados, las distribuciones se ven asi:

.pull-left[
```{r, echo=FALSE,message=FALSE,warning=FALSE,header=FALSE}
out<-rdplot(data$cambio_esp_top,data$cambio_internet,nbins=c(20,20),x.lim=c(-10,40),title="",x.label="Cambio Internet",y.label="Cambio Espanol, kernel = "triangular",c=15,h=5,p=1 , binselect = "qspr")
```
]

.pull-right[
```{r, echo=FALSE,message=FALSE,warning=FALSE,header=FALSE}
out<-rdplot(data$cambio_mat_top,data$cambio_internet,nbins=c(20,20),x.label="Cambio Internet",x.lim=c(-10,40),y.label="Cambio Mate, kernel = "triangular",c=15,h=7 ,p=1, binselect = "qspr")
```
]

---

## Covariables

Para incluir a las covariables en nuestra estimacion, debemos verificar que no sean distintas en el grupo de tratamiento y de control en el punto de corte (+/- el ancho de banda). En caso de que fueran distintas, no se cumpliria el supuesto de continuidad, por lo que se tendrian que imponer restricciones adicionales. 

Definimos a las covariables: 

\begin{align*}
Z_i =& 
  \begin{cases}
    1, & G_i \geq c \\
    0, & G_i < c
  \end{cases}
\end{align*}

Donde Zi(1) y Zi(0) denotan dos vectores de covariables de potenciales- Zi(1) representa el valor que toman las covariables arriba del punto de corte (tratamiento) y Zi(0) los respectivos del control. Se asume que el valor de las covariables fue determinado antes del tratamiento, por lo que su efecto de tratamiento es cero. 

---
Realizamos una tabla de balance para verificar que las covariables esten balanceadas en [h-c,c+h]:

```{r, results='asis',echo=FALSE,message=FALSE,warning=FALSE,include=FALSE}
# Ahora vamos a ver si covariates son iguales en el punto de corte
data$marg<-recode(data$marg_10, 'BAJA O MUY BAJA'=3, 'MUY ALTA O ALTA'=2, 
                  'MEDIA'=1)
as.numeric(data$marg)
```

```{r, echo=FALSE,message=FALSE,warning=FALSE,header=FALSE}
#este es con un ancho de banda de 5
marg_C<-(data$marg[cambio_internet>=9 & cambio_internet<=14])
marg_T<-(data$marg[cambio_internet>=15 & cambio_internet<=20])
promesc_C<-(data$promesc_20[cambio_internet>=9 & cambio_internet<=14])
promesc_T<-(data$promesc_20[cambio_internet>=15 & cambio_internet<=20])
pocup_C<-(data$pocup_20[cambio_internet>=9 & cambio_internet<=14])
pocup_T<-(data$pocup_20[cambio_internet>=15 & cambio_internet<=20])
```

```{r, echo=FALSE,message=FALSE,warning=FALSE,header=FALSE}
#prom esc es igual en tratamiento y control en el punto de corte (con un bandwidth de 5)
t.test(promesc_T,promesc_C,alternative="two.sided")
#Pob ocupada si es igual en el punto de corte (con un bandwidth de 8)
t.test(pocup_T,pocup_C,alternative="two.sided")
# marginacion. si son iguales
t.test(marg_T,marg_C,alternative="two.sided")
```

El balance entre el grupo de control y el grupo de tratamiento en el punto de corte es:

```{r, echo=FALSE,message=FALSE,warning=FALSE,header=FALSE}
Variable<-c("Promedio escolaridad", "Poblacion ocupada", "Nivel Marginacion")
Media.C<-c("1.006","43.928","1.903")
Media.T<-c("1.440", "44.620","1.855")
Diferencia<-c("0.434", "0.692","-0.048")
Valor.p<-c("0.00000", "0.0176","0.008")
kable(dataf, booktabs=T,format = "latex",col.names=c("Variable", "Media control", "Media Tratamiento","Diferencia","Valor-p")) %>% kable_styling(position = "center")
```


Dado que las covariables no estan balanceadas dentro del punto de corte y el ancho del intervalo [c-h,c+h], no las incluiremos en la estimacion. Segun Cattaneo et al (2017), la especificacion 

$$\delta NivelLogro_i =\beta_0 + \beta_1 T_i + \beta_2 G_i + u_i$$

es suficiente para el analisis que queremos llevar a cabo.

---

## Implementación

Ahora, realizaremos nuestra estimacion utilizando:

+ Un ancho de banda *h* de 8 para espanol y 7 para matematicas;
+ Una funcion kernel triangular;
+ Errores agrupados a nivel municipal;
+ Punto de corte $c_i$ en 15
+ Polinomio de orden 1 (RD local lineal)

.pull-left[
```{r, echo=FALSE,message=FALSE,warning=FALSE,header=FALSE}
out = rdrobust(data$cambio_esp_top,data$cambio_internet, kernel = "triangular", c=15,p = 1, bwselect = "mserd",cluster=data$ClaveMun)
summary(out)
```
]

.pull-right[
```{r, echo=FALSE,message=FALSE,warning=FALSE,header=FALSE}
out1 = rdrobust(data$cambio_mat_top,data$cambio_internet, kernel = "triangular", c=15,p = 1, bwselect = "mserd",cluster=data$ClaveMun)
summary(out1)
```
]

---

## Interpretacion

La interpretacion es que, dentro del intervalo de cambio en internet [15-5,15+5], el cambio de las calificaciones en espanol promedio de las localidades rurales aumenta en .846 puntos porcentuales por tener acceso a Internet. 

Este coeficiente representa a la diferencia en los puntajes en espanol de las localidades que tienen acceso a Internet *apenas por encima* del punto de corte, que es de un cambio en el puntaje de 4.18 pp, menos el de las localidades que *apenas* estan por debajo del punto de corte, que es de 3.32 pp.

En el caso de matematicas, esta diferencia viene de la puntuacion del grupo de tratamiento en la vecindad del punto de corte, que es de 6.71 pp, menos el de control, que es de 4.59 pp.

```{r, echo=FALSE,message=FALSE,warning=FALSE,header=FALSE}
print(out$beta_p_r)
```

```{r, echo=FALSE,message=FALSE,warning=FALSE,header=FALSE}
print(out$beta_p_l)
```
```{r, echo=FALSE,message=FALSE,warning=FALSE,header=FALSE}
print(out1$beta_p_r)
```

```{r, echo=FALSE,message=FALSE,warning=FALSE,header=FALSE}
print(out1$beta_p_l)
```
---

## Resultados

<div style="text-align: justify">
  
  + Relación hallazgos con bibliográfía 
  + Aportación del trabajo



---

## Conclusiones

+ Se comprueba la hipótesis
+ Aportación
+ Trabajo + Trabajo futuro
+ Aplicación en PP o privada

---

## Posibles cambios

+ Cambiar la variable dependiente a "proporcion de alumnos que cambiaron de *bottom* a *top*

+ Cambiar la variable independiente a cambio de proporcion de hogares que tienen Internet junto con adquisicion de computadoras, laptops o tablets

+ Anadir variable de control de region


---








