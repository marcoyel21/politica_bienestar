---
title: archivo de trabajo
author: John Doe
date: March 22, 2005
output: html_document
---

```{r}
library(readxl)
library(readr)
library(stargazer)
library(dplyr)
library(ggplot2)
library(kableExtra)
censo<-read.csv("censo.csv")#censo es el nombre de la base de datos que bajan de aqui https://www.inegi.org.mx/contenidos/programas/ccpv/iter/zip/iter2020/iter_nalcsv20.zip
planea_15<-read_xlsx("PLANEA_2015.xlsx")
planea_19<-read_xlsx("PLANEA_2019.xlsx")

#limpieza
planea_15 <- planea_15[-c(1:2),]
planea_19 <- planea_19[-c(1:7),]
```

---
## Tema

Causalidad del acceso a Internet en el desempeño escolar de los estudiantes mexicanos.

---
## Cuadro bibliografía 


--- 
## Justificación relevancia para el tema

México tiene una brecha digital considerable, el cual es un reto difícil de sobrellevar dadas fallas regulatorias institucionales, una geografía compleja y densidades de población heterogéneas. (cita Ovando). Se encuentra en el X lugar de technological readiness. Chile, por ejemplo, se encuentra en X (World Economic Forum, checar). 

La Reforma en telecomunicaciones del 2013 fue llevada a cabo en un contexto en el que el mercado de telecomunicaciones en México, desde los 90s, estaba altamente concentrado, resultando en falta de competencia, calidad de servicios baja, precios altos, y una penetración de banda ancha baja, en relación a países comparables en América Latina. (Noll).

Entre varios cambios establecidos por la recién establecida 


La demanda del mercado mexicano tiene barreras a la adopción de internet, como tasas de pobreza altas y acceso desigual a servicios de educación, salud, y vivienda. (Ovando) La ENDUTIH reporta que la principal razón para no adoptarla (55.2%) es por falta de recursos económicos. 

uso del internet

los esfuerzos por aumentar el acceso a internet en las escuelas puede aumentar la magnitud del desempeño de los estudiantes si se implementan políticas que aumenten el acceso a Internet en los hogares, así como en las escuelas.



---
## Aportación del trabajo (hipótesis)

El trabajo examinará el efecto de acceso a Intenet a nivel localidad en el desempeño escolar de estudiantes utilizando los datos que provee el gobierno de la evaluación Planea, la cual se aplica a alumnos de 3° de secundaria en los ámbitos de Matemáticas y Lenguaje en el año 2019. 

Se utilizará el método *propensity score matching* para evaluar el impacto del internet en las localidades en los resultados de las pruebas, controlando por variables como nivel de marginación, entorno rural, tipo de escuela

Se utilizará por primera vez la base generada en el Censo del 2020, la de Principales resultados por localidad (ITER). Esta base cuenta con 

Esperaríamos  que las localidades que tienen mayores proporciones de viviendas con acceso a Internet tengan mejores resultados en la evaluación, controlando por covariables relacionadas a los hogares y a la localidad.  



---

## Descriptivas

# Pasos

A) Encontrar acceso a internet (y variables que propuso sam) en censo a nivel localidad
```{r}
#convierto variables de interes a numéricas
names<-c('VIVTOT','TVIVPAR','VIVPAR_HAB', #localidad
         'VPH_INTER','VPH_PC') #internet y laptop

for (i in names){
    censo[[i]] <- as.numeric(censo[[i]])
}


#creo la base de datos de interes
censo_localidad<-censo %>% 
  select(NOM_ENT,NOM_MUN,NOM_LOC,     #localidad           
         VIVTOT,TVIVPAR,VIVPAR_HAB,       # vivienda
         VPH_INTER,VPH_PC)   %>%    # internet y laptop
        mutate(internet=VPH_INTER*100/VIVTOT,
               lap=VPH_PC*100/VIVTOT)
#cambio todo a mayus
censo_localidad <- as.data.frame(t(apply(censo_localidad,1,toupper)))
  
```

B) Encontrar calis (o mas bien distribucion de calis en planea) a nivel localidad


```{r}
#Para planea 19

#convierto variables de interes a numéricas

names<-c('...23','...24','...25','...26', #calis esp
         '...35','...36','...37','...38') #calis mate

for (i in names){
    planea_19[[i]] <- as.numeric(planea_19[[i]])
}


#creo la base de datos de interes

planea_localidad<-planea_19 %>% 
  select(...2,...6,...7,                  # son entidad, municipio y loc
         ...23,...24,...25,...26,       # son % de calis de español
         ...35,...36,...37,...38)   %>% # son % de calis de mate
  group_by(...2,...6,...7) %>%
  summarize(esp_1 = mean(...23), 
            esp_II= mean(...24),
            esp_1II = mean(...25), 
            esp_IV= mean(...26),
            mat_1 = mean(...35), 
            mat_II= mean(...36),
            mat_1II = mean(...37), 
            mat_IV= mean(...38),) %>%
  mutate(top_50_esp=esp_1II+esp_IV,
         top_50_mat=mat_1II+mat_IV) #convierto a mi variable de interes (porcentaje de niños en la mejor mitad)

#cambio todo a mayus
planea_localidad <- as.data.frame(t(apply(planea_localidad,1,toupper)))
  

#cambio nombres

names(planea_localidad)[names(planea_localidad) == "...2"] <- "NOM_ENT"
names(planea_localidad)[names(planea_localidad) == "...6"] <- "NOM_MUN"
names(planea_localidad)[names(planea_localidad) == "...7"] <- "NOM_LOC"


```

C) Hacer regresion

```{r}
#creo la base de datos
data<-as.data.frame(merge(planea_localidad,censo_localidad, by= c("NOM_ENT","NOM_MUN","NOM_LOC"))) %>% na.omit()
#perdimos muchas obervaciones por la codificacion

#convierto variables de interes a numéricas
names<-c("esp_1","esp_II","esp_1II","esp_IV",    
         "mat_1","mat_II","mat_1II","mat_IV",
         "top_50_esp","top_50_mat",
         "VIVTOT", "TVIVPAR","VIVPAR_HAB","VPH_INTER","VPH_PC",
         "internet","lap" )  
for (i in names){
    data[[i]] <- as.numeric(data[[i]])
}

a<-lm(top_50_mat~internet,data)
b<-lm(top_50_mat~lap,data)
c<-lm(top_50_esp~internet,data)
d<-lm(top_50_esp~lap,data)

stargazer(a,b,c,d,type="text")

````

# Overlap

```{r}

data<-data%>% mutate(dummy_internet=ifelse(internet>1,1,0),
                     dummy_lap=ifelse(lap>1,1,0))

data$dummy_internet<-as.factor(data$dummy_internet)   
data$dummy_lap<-as.factor(data$dummy_lap) 
 data %>%
  ggplot( aes(x=top_50_mat, fill=dummy_internet)) +
    geom_histogram( color="#e9ecef", alpha=0.2, position = 'identity') +
    scale_fill_manual(values=c("#69b3a2", "#404080")) 
 
  data %>%
  ggplot( aes(x=top_50_mat, fill=dummy_lap)) +
    geom_histogram( color="#e9ecef", alpha=0.2, position = 'identity') +
    scale_fill_manual(values=c("#69b3a2", "#404080")) 
  
 data %>%
  ggplot( aes(x=top_50_esp, fill=dummy_internet)) +
    geom_histogram( color="#e9ecef", alpha=0.2, position = 'identity') +
    scale_fill_manual(values=c("#69b3a2", "#404080")) 
 
  data %>%
  ggplot( aes(x=top_50_esp, fill=dummy_lap)) +
    geom_histogram( color="#e9ecef", alpha=0.2, position = 'identity') +
    scale_fill_manual(values=c("#69b3a2", "#404080")) 
  
  
```


# Estadistica descriptiva
```{r}
#ya tenemos la base de datos preliminar y podemos poner cualquier estadistica descriptiva


#para datos comunidades con internet
stargazer((data[data$dummy_internet==1,]),type="text")

#para datos comunidades sin internet
stargazer((data[data$dummy_internet==0,]),type="text")


#para datos comunidades con lap
stargazer((data[data$dummy_lap==1,]),type="text")

#para datos comunidades sin lap
stargazer((data[data$dummy_lap==0,]),type="text")

```

# Comentarios

Buenas noticias:

+ tenemos info desagregada por localidad

+ Las bases de planea se prestan para un matching entre escuelas o localidads o municipios con y sin internet (en propencity o en acceso real)


Malas noticias:

+ No podemos hacer un dif and dif o algo de serie de tiempo porque el censo es de hecho ex post y solo tenemos un censo, no hay info intermedia entre ambas planeas.

+ Debido a esto solo podemos usar un planea (preferiblemente el mas cercano al censo)


Por trabajar:

+ Definir bien nuestra Y (por lo pronto yo propuse orcentaje de niños en la mitad mas alta porque no estan las calis perse)

+ Definir bien nuestro T (por lo pronto yo propuse una dummy de internet y otra dummy de lap pero se puede mejorar)

+ Mejorar el filtro de comunidades porque al final solo nos quedaron 9046 localidades que hicieron el empate textual(esto se puede deber a mala codificacion entre inegi y planea)

+ Decidir que hacer con las comunidades tan pequeñas que solo tienen pocas casas y en consecuenica tienen NA en lap e internet.





