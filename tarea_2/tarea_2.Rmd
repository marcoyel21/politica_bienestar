---
output:
  pdf_document: default
geometry: margin=1in
fontsize: 11pt
header-includes :
  \usepackage{geometry}
  \usepackage{graphicx}
  \tolerance=1
  \hyphenpenalty=10000
  \hbadness=10000
  \linespread{1.3}
  \usepackage[justification=centering, font=bf, labelsep=period, skip=5pt]{caption} 
  \usepackage{titling}
  \usepackage[spanish]{babel}
  \usepackage{fancyhdr}
  \pagestyle{fancy}
  \fancyhead[L]{Maestría en Economía Aplicada}
  \fancyhead[R]{ITAM}
---
\begin{titlepage}
\begin{center}

\textsc{\Large Instituto Tecnológico Autónomo de México}\\[2em]

\textbf{\LARGE Bienestar y Política Social}\\[2em]


\textsc{\LARGE }\\[1em]


\textsc{\large Tarea 2 }\\[1em]

\textsc{\LARGE }\\[1em]

\textsc{\large }\\[1em]
\textsc{\LARGE }\\[1em]
\textsc{\LARGE }\\[1em]

\textsc{\large }\\[1em]
\textsc{\LARGE }\\[1em]

\textsc{\LARGE Dra. Araceli Ortega Díaz}\\[1em]

\textsc{\LARGE }\\[1em]
\textsc{\LARGE }\\[1em]

\textsc{\LARGE Marco Antonio Ramos Juárez}\\[1em]

\textsc{\large 142244}\\[1em]

\textsc{\LARGE Mayra Samantha Cervantes Bravo}\\[1em]

\textsc{\large 141371}\\[1em]

\textsc{\LARGE Cynthia Raquel Valdivia Tirado }\\[1em]

\textsc{\large 81358}\\[1em]

\end{center}

\vspace*{\fill}
\textsc{Ciudad de México \hspace*{\fill} 2021}

\end{titlepage}


\newpage


\tableofcontents

\newpage

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)

#cargo librerias
library(dplyr)
library(ggplot2)
library(ggthemes)
library(kableExtra)

library(readr)
library(corrplot)

#importo los datos
data<-read_csv("muestra_idd.csv")


```

# Metodología.

El proposito de esta tarea es desarrollar un nuevo índice (con base en el trabajo existente del CONEVAL) que pueda focalizar a un grupo específico de la clase media, aquellos que solamente tienen pobreza de ingresos, es decir que no presentan ninguna de las X carencias. Sin duda, este grupo es sumamente interesante y presenta un reto en cuanto a la focalización debido a dos razones: en primer lugar, debido a que es la población más pequeña dentro de los cuadrantes previamente delimitados por el Comité XXXX del CONEVAL, en este sentido el reto es que nuestro modelo sea lo suficientemente estricto como para no perder ninguna observación; en segundo lugar, porque es un grupo con características que se podrían conceptualizar como contradictorias.

Para abordar este reto debemos realizar un investigación comprensiva que incluya tanto exploración de las variables disponibles en las bases de datos pertinentes como también una revisión breve de literatura acerca de lo que se sabe de este grupo. Esto con el fin de tener tanto una perspectiva estadística pero también teórica del grupo. Por ello, decidimos hacer un análisis exploratorio de manera independiente y paralela a la revisión de liateratura con el objetivo de identificar las variables importantes, en donde esperemos que ambos caminos nos lleven a encontrar variables similares para posteriormente contrastar resultados.

En segundo lugar, debemos hacer una sintesis de ambos hallazgos con el fin de obtener la selección de variables final. En tercer lugar, procederemos a estimar un modelo logistico donde nuestra variable independiente es solamente una variable dicotómica que indica la pertenencia al cuadrante 3, nuestra población objetivo. En cuarto lugar, compararemos la clasificación que indica el modelo en contra de la clasificación original del CONEVAL. Finalmente, haremos una breve conclusión del ejercicio.

# Estadística descriptiva.

#. Estimación de modelo

```{r}

#Como la base de datos es muy grande, propongo una muestra aleatoria de tamaño n para "jugar"

data_filtered<-data%>%select(y_3,plb, s_salud, jef_ss,ss_dir,
                              rururb,ic_sbv,tam_loc ,ic_rezedu, 
                               ic_asalud ,ic_cv,isb_combus,ic_ali)

logitMod <- glm(y_3 ~ ., data=data_filtered, family=binomial(link="logit"))


#Creo una función para generar matriz de confusión
confusion.glm <- function(data, model) {
  prediction <- ifelse(predict(model, data, type='response') > 0.5, TRUE, FALSE)
  confusion  <- table(prediction, as.logical(model$y))
  confusion  <- cbind(confusion, c(1 - confusion[1,1]/(confusion[1,1]+confusion[2,1]), 1 - confusion[2,2]/(confusion[2,2]+confusion[1,2])))
  confusion  <- as.data.frame(confusion)
  names(confusion) <- c('FALSE', 'TRUE', 'class.error')
  confusion
}

#Genero la matriz de confusión
confusion.glm(data_filtered,logitMod)

```


# Resultados.

# Comparación.

# Conclusiones.

